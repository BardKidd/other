(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AllSingleStoreOrder"],{"2dd8":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("article",[t._m(0),t.orderRows.length>0?r("section",{staticClass:"mb-3"},[r("OrderTemplate",{key:t.keyData,attrs:{orderProduct:t.orderRows},on:{exportAllQuantity:t.getAllOrderTemplateQuantity,removeTemplate:t.removeProduct}})],1):r("section",{staticClass:"pl-2 mb-2"},[t._v("暫無訂購品項...")]),t._m(1),t.prRows.length>0?r("section",{staticClass:"mb-3"},[r("PRTemplate",{key:2*t.keyData,attrs:{prProduct:t.prRows},on:{exportAllQuantity:t.getAllPRTemplateQuantity,removeTemplate:t.removeProduct}})],1):r("section",{staticClass:"pl-2 mb-2"},[t._v("暫無公關品項...")]),r("div",{staticClass:"result-wrap"},[r("div",{staticClass:"item"},[t._v(" 訂購總量 "),r("span",[t._v(t._s(t.totalOrderQuantity))])]),r("div",{staticClass:"item"},[t._v(" 公關總量 "),r("span",[t._v(t._s(t.totalPRQuantity))])]),r("div",{staticClass:"amount",staticStyle:{"background-color":"#fff"}},[t._v(" 總品項 "),r("span",[t._v(t._s(t.totalOrderQuantity+t.totalPRQuantity))])]),r("button",{staticClass:"btn btn_info",attrs:{type:"button"},on:{click:t.openCheck}},[t._v(" 確認訂單 ")])]),r("Order",{on:{sendData:t.sendData}}),r("CheckOrder",{attrs:{IsMainStore:!1,DeliveryDate:t.allDeliveryDate,DeliveryTime:t.allDeliveryTime,Charge:t.allCharge,Freight:t.allFreight}})],1)])},a=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"table-title"},[r("span",[t._v("訂購品項")]),r("button",{staticClass:"btn btn_primary",attrs:{type:"button","data-toggle":"modal","data-target":"#placeordermodal"}},[t._v(" 新增品項 ")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"table-title mt-2"},[r("span",[t._v("公關品項")]),r("button",{staticClass:"btn btn_primary",attrs:{type:"button","data-toggle":"modal","data-target":"#placeordermodal"}},[t._v(" 新增品項 ")])])}],o=r("2909"),u=r("5530"),i=(r("99af"),r("d3b7"),r("6062"),r("3ca3"),r("ddb0"),r("4de4"),r("159b"),r("a9e3"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{key:t.keyData,staticClass:"table-wrap"},[r("table",{staticClass:"w-100 common-datatable datatable stripe order-column"},[t._m(0),r("tbody",t._l(t.allProduct,(function(e,n){return r("tr",{key:e.ProductGuid+"-"+e.IsPending},[r("td",[t._v(t._s(e.ItemNo))]),r("td",[r("span",{directives:[{name:"show",rawName:"v-show",value:e.IsPending,expression:"product.IsPending"}],staticClass:"pendingOrder"},[t._v("掛單")])]),r("td",[t._v(t._s(e.ItemName)+"/"+t._s(e.Specification))]),r("td",{staticClass:"text-center"},[t._v(t._s(e.InvQty))]),r("VP",{attrs:{tag:"td",name:"訂購數量",rules:"max_value:9999|min_value:1"}},[r("input",{directives:[{name:"model",rawName:"v-model.number",value:e.orderQuantity,expression:"product.orderQuantity",modifiers:{number:!0}}],staticClass:"w-100",attrs:{type:"number",max:"9999",disabled:e.IsPending&&e.InvQty>0,placeholder:"請輸入數量"},domProps:{value:e.orderQuantity},on:{keyup:function(r){return t.checkQuantity(e,"訂購")},change:function(r){return t.checkQuantity(e,"訂購")},input:function(r){r.target.composing||t.$set(e,"orderQuantity",t._n(r.target.value))},blur:function(e){return t.$forceUpdate()}}})]),r("VP",{attrs:{tag:"td",name:"寄倉數量",rules:"max_value:9999|min_value:0"}},[r("input",{directives:[{name:"model",rawName:"v-model.number",value:e.warehousesNum,expression:"product.warehousesNum",modifiers:{number:!0}}],staticClass:"w-100",attrs:{type:"number",placeholder:"請輸入數量",disabled:e.IsPending},domProps:{value:e.warehousesNum},on:{keyup:function(r){return t.checkQuantity(e,"寄倉")},change:function(r){return t.checkQuantity(e,"寄倉")},input:function(r){r.target.composing||t.$set(e,"warehousesNum",t._n(r.target.value))},blur:function(e){return t.$forceUpdate()}}})]),r("td",{staticClass:"text-center"},[t._v(" "+t._s(e.UnitPrice)+" ")]),r("td",{staticClass:"text-center"},[t._v(" "+t._s(e.orderQuantity*e.UnitPrice||0)+" ")]),r("td",[r("button",{staticClass:"btn btn_danger",attrs:{type:"button"},on:{click:function(e){return t.delItem(n)}}},[t._v(" 移除 ")])])],1)})),0),r("InventoryShortageModal",{ref:t.currentObj.ProductGuid,attrs:{Guid:t.currentObj.ProductGuid,InvQty:t.currentObj.InvQty,screenTotal:Number(t.currentObj.orderQuantity),currentValue:Number(t.currentObj.orderQuantity),totalMinusScreen:Number(t.currentObj.orderQuantity-t.currentObj.InvQty)},on:{confirmQuantity:t.InventoryShortItem,returnMax:t.returnMax}})],1)])}),s=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("thead",[r("tr",{staticClass:"text-center"},[r("th",[t._v("品號")]),r("th"),r("th",[t._v("品名/規格")]),r("th",[t._v("庫存量")]),r("th",[t._v("訂購數量")]),r("th",[t._v("寄倉數量")]),r("th",[t._v("售價(含稅)")]),r("th",[t._v("小計(含稅)")]),r("th")])])}],c=(r("a434"),r("d81d"),r("c3b6")),l={name:"OrderTemplate_Single",props:{orderProduct:Array},data:function(){return{allProduct:[],currentObj:{},keyData:1}},methods:{checkQuantity:function(t,e){var r=this;if("寄倉"===e&&t.warehousesNum>t.orderQuantity)return r.$notify({title:"提示",message:"寄倉數量不得大於訂購數量",type:"warning",duration:5e3}),void r.$nextTick((function(){t.warehousesNum=t.orderQuantity}));r.currentObj=Object(u["a"])({},t),r.currentObj.IsPending||r.currentObj.orderQuantity>r.currentObj.InvQty&&r.$nextTick((function(){var t=r.$refs[r.currentObj.ProductGuid].$el;$(t).modal("show")})),r.$nextTick((function(){r.$emit("exportAllQuantity")}))},InventoryShortItem:function(t,e,r){this.print("整批還分批",e);var n=this,a={};n.allProduct.some((function(r){r.ProductGuid===t.Guid&&(a=Object(u["a"])(Object(u["a"])({},r),{},{IsPartialDelivery:t.IsPartialDelivery,orderQuantity:e?t.PartialDeliveryQuantity:t.orderQuantity,IsPending:!0}))})),e?(n.allProduct.some((function(t,e){if(t.ProductGuid===a.ProductGuid&&t.IsPending)return n.delItem(e),!0})),n.allProduct.some((function(t,e){if(t.ProductGuid===a.ProductGuid)return n.allProduct.splice(e+1,0,a),!0})),n.allProduct.some((function(t){if(t.ProductGuid===a.ProductGuid){var e="訂購"===r?"orderQuantity":"warehousesNum";return t[e]=t[e]-a[e],!0}}))):(n.allProduct.some((function(t,e){if(t.ProductGuid===a.ProductGuid&&t.IsPending)return n.delItem(e),!0})),n.allProduct.some((function(t){if(t.ProductGuid===a.ProductGuid&&!t.IsPending)return t.IsPending=!0,t.orderQuantity=a.orderQuantity,n.keyData+=1,!0})))},returnMax:function(t){var e=this;e.currentObj.orderQuantity=e.currentObj.InvQty,e.allProduct.some((function(r){if(r.ProductGuid===t)return r.orderQuantity=e.currentObj.InvQty,e.$emit("exportAllQuantity"),!0}))},delItem:function(t){var e=this;e.allProduct.some((function(e,r){if(t===r)return!0})),e.allProduct.splice(t,1),e.$emit("removeTemplate",!0)}},watch:{allQuantity:function(){var t=this;t.$emit("exportAllQuantity")}},computed:{allQuantity:function(){var t=this;return t.allProduct.map((function(t){return Number(t.orderQuantity)}))}},mounted:function(){var t=this;t.allProduct=t.orderProduct},components:{InventoryShortageModal:c["a"]},destroyed:function(){$(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()}},d=l,m=r("2877"),v=Object(m["a"])(d,i,s,!1,null,null,null),y=v.exports,f=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{key:t.keyData,staticClass:"table-wrap"},[r("table",{staticClass:"w-100 common-datatable datatable stripe order-column"},[t._m(0),r("tbody",t._l(t.allProduct,(function(e,n){return r("tr",{key:e.ProductGuid+"-"+e.IsPending},[r("td",[t._v(t._s(e.ItemNo))]),r("td",[r("span",{directives:[{name:"show",rawName:"v-show",value:e.IsPending,expression:"product.IsPending"}],staticClass:"pendingOrder"},[t._v("掛單")])]),r("td",[t._v(t._s(e.ItemName)+"/"+t._s(e.Specification))]),r("td",{staticClass:"text-center"},[t._v(t._s(e.InvQty))]),r("VP",{attrs:{tag:"td",name:"訂購數量",rules:"max_value:9999|min_value:1"},scopedSlots:t._u([{key:"default",fn:function(n){return[r("input",{directives:[{name:"model",rawName:"v-model.number",value:e.orderQuantity,expression:"product.orderQuantity",modifiers:{number:!0}}],staticClass:"w-100",attrs:{type:"number",max:"9999",placeholder:"請輸入數量",disabled:e.IsPending&&e.InvQty>0},domProps:{value:e.orderQuantity},on:{keyup:function(r){return t.checkQuantity(e,"訂購")},change:function(r){return t.checkQuantity(e,"訂購")},input:function(r){r.target.composing||t.$set(e,"orderQuantity",t._n(r.target.value))},blur:function(e){return t.$forceUpdate()}}}),n?r("span",{staticClass:"text-danger small font-weight-bold"},[t._v(t._s(n[0]))]):t._e()]}}],null,!0)}),r("VP",{attrs:{name:"寄倉數量",tag:"td",rules:"max_value:9999|min_value:0"},scopedSlots:t._u([{key:"default",fn:function(n){return[r("input",{directives:[{name:"model",rawName:"v-model.number",value:e.warehousesNum,expression:"product.warehousesNum",modifiers:{number:!0}}],staticClass:"w-100",attrs:{type:"number",placeholder:"請輸入數量",disabled:e.IsPending},domProps:{value:e.warehousesNum},on:{keyup:function(r){return t.checkQuantity(e,"寄倉")},change:function(r){return t.checkQuantity(e,"寄倉")},input:function(r){r.target.composing||t.$set(e,"warehousesNum",t._n(r.target.value))},blur:function(e){return t.$forceUpdate()}}}),n?r("span",{staticClass:"text-danger small font-weight-bold"},[t._v(t._s(n[0]))]):t._e()]}}],null,!0)}),r("td",{staticClass:"text-center"},[t._v(" "+t._s(e.UnitPrice)+" ")]),r("td",{staticClass:"text-center"},[t._v(" "+t._s(e.orderQuantity*e.UnitPrice||0)+" ")]),r("td",[r("button",{staticClass:"btn btn_danger",attrs:{type:"button"},on:{click:function(e){return t.delItem(n)}}},[t._v(" 移除 ")])])],1)})),0),r("InventoryShortageModal",{ref:t.currentObj.ProductGuid,attrs:{Guid:t.currentObj.ProductGuid,InvQty:t.currentObj.InvQty,screenTotal:Number(t.currentObj.orderQuantity),currentValue:Number(t.currentObj.orderQuantity),totalMinusScreen:Number(t.currentObj.orderQuantity-t.currentObj.InvQty)},on:{confirmQuantity:t.InventoryShortItem,returnMax:t.returnMax}})],1)])},p=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("thead",[r("tr",{staticClass:"text-center"},[r("th",[t._v("品號")]),r("th"),r("th",[t._v("品名/規格")]),r("th",[t._v("庫存量")]),r("th",[t._v("訂購數量")]),r("th",[t._v("寄倉數量")]),r("th",[t._v("售價(含稅)")]),r("th",[t._v("小計(含稅)")]),r("th")])])}],h={name:"PRTemplate_Single",props:{prProduct:Array},data:function(){return{allProduct:[],currentObj:{},keyData:1}},methods:{checkQuantity:function(t,e){var r=this;if("寄倉"===e&&t.warehousesNum>t.orderQuantity)return r.$notify({title:"提示",message:"寄倉數量不得大於訂購數量",type:"warning",duration:5e3}),void r.$nextTick((function(){t.warehousesNum=t.orderQuantity}));r.currentObj=Object(u["a"])({},t),r.currentObj.IsPending||r.currentObj.orderQuantity>r.currentObj.InvQty&&r.$nextTick((function(){var t=r.$refs[r.currentObj.ProductGuid].$el;$(t).modal("show")})),r.$nextTick((function(){r.$emit("exportAllQuantity")}))},InventoryShortItem:function(t,e,r){var n=this;this.print("整批還分批",e);var a=this,o={};a.allProduct.some((function(r){r.ProductGuid===t.Guid&&(o=Object(u["a"])(Object(u["a"])({},r),{},{IsPartialDelivery:t.IsPartialDelivery,orderQuantity:e?t.PartialDeliveryQuantity:t.orderQuantity,IsPending:!0}))})),e?(a.allProduct.some((function(t,e){if(t.ProductGuid===o.ProductGuid&&t.IsPending)return a.delItem(e),!0})),a.allProduct.some((function(t,e){if(t.ProductGuid===o.ProductGuid)return a.allProduct.splice(e+1,0,o),!0})),a.allProduct.some((function(t){if(t.ProductGuid===o.ProductGuid){var e="訂購"===r?"orderQuantity":"warehousesNum";return t[e]=t[e]-o[e],!0}}))):(a.allProduct.some((function(t,e){if(t.ProductGuid===o.ProductGuid&&t.IsPending)return a.delItem(e),!0})),a.allProduct.some((function(t){if(n.print("庫存不足 Modal 傳出來的資料",o),t.ProductGuid===o.ProductGuid&&!t.IsPending)return t.IsPending=!0,t.orderQuantity=o.orderQuantity,a.keyData+=1,!0})))},returnMax:function(t){var e=this;e.currentObj.orderQuantity=e.currentObj.InvQty,e.allProduct.some((function(r){if(r.ProductGuid===t)return r.orderQuantity=e.currentObj.InvQty,e.$emit("exportAllQuantity"),!0}))},delItem:function(t){var e=this;e.allProduct.some((function(e,r){if(t===r)return!0})),e.allProduct.splice(t,1),e.$emit("removeTemplate",!0)}},watch:{allQuantity:function(){var t=this;t.$emit("exportAllQuantity")}},computed:{allQuantity:function(){var t=this;return t.allProduct.map((function(t){return Number(t.orderQuantity)}))}},mounted:function(){var t=this;t.allProduct=t.prProduct},components:{InventoryShortageModal:c["a"]},destroyed:function(){$(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()}},P=h,b=Object(m["a"])(P,f,p,!1,null,null,null),_=b.exports,g=r("2530"),Q=r("2725"),I=r("6e77"),w=r("a9de"),O=r("d072"),k=r("5f2c"),C={name:"AllSingleStoreOrder",mixins:[I["a"],w["a"]],data:function(){return{rows:[],tempRows:[],orderRows:[],prRows:[],totalOrderQuantity:0,totalPRQuantity:0,allDeliveryTime:[],allCharge:{Sales_Fees:{Costs:30}},allFreight:{Sales_Fees:{Costs:30}},allDeliveryDate:{},keyData:1}},methods:{sendData:function(t){var e=this;this.print("tmepCheck",t),t[0]=Object(u["a"])(Object(u["a"])({},t[0]),{},{IsPending:!t[0].InvQty,IsPartialDelivery:!1,orderQuantity:1,warehousesNum:0}),delete t[0].DetailRows,t.some((function(r){if(r.IsOrder&&r.IsPR)return e.splitRow(t),!0})),t.length>0&&(e.rows=e.rows.concat(t),e.$nextTick((function(){e.filterTemplate(t)}))),$("#placeordermodal").modal("hide")},removeProduct:function(t){var e=this;e.$nextTick((function(){if(t){var r=new Set,n=e.rows.filter((function(t){return!r.has(t.ItemNo)&&r.add(t.ItemNo)})),a=Object(o["a"])(n);e.$store.commit("SUREPRODUCT",a)}})),this.keyData+=1},openCheck:function(){var t=this;if(0===t.rows.length)return t.$notify({title:"提示",message:"請先選擇商品",type:"warning",duration:3500}),!1;$("#check").modal("show");var e=JSON.parse(JSON.stringify(t.rows)),r=[{ReceiveAddress:t.customerData.ShippingAddress,ReceiveContact:t.customerData.TEL_NO,ReceiveName:t.customerData.Owner,Guid:e[0].ProductGuid,productData:e,store:t.customerData}];t.$store.commit("SENDBRANCHSTORE",r)},getAllOrderTemplateQuantity:function(){var t=this;t.totalOrderQuantity=0,t.orderRows.forEach((function(e){t.totalOrderQuantity+=Number(e.orderQuantity)}))},getAllPRTemplateQuantity:function(){var t=this;t.totalPRQuantity=0,t.prRows.forEach((function(e){t.totalPRQuantity+=Number(e.orderQuantity)}))}},mounted:function(){var t=this;t.$store.commit("HEADER","單店訂單作業"),t.$store.commit("ISWELCOME",!1),t.$store.commit("ISGOBACK",!0),t.rows=t.$route.params.confirmProduct||JSON.parse(localStorage.getItem("sureProduct")),"SingleStoreOrder"===localStorage.getItem("routerFrom")?(t.splitRow(t.rows),t.filterTemplate(t.rows),t.$nextTick((function(){t.rows.forEach((function(e){e.IsPending=!e.InvQty,e.IsPartialDelivery=!1,e.orderQuantity=1,e.warehousesNum=0,delete e.DetailRows,t.keyData+=1}))}))):"OrderSearch"===localStorage.getItem("routerFrom")&&t.OrderSearchFilter(t.rows),t.allDeliveryTime=O.Data,t.allDeliveryDate=k.Data},watch:{orderRows:function(t){var e=this;e.rows=e.prRows.concat(t)},prRows:function(t){var e=this;e.rows=e.orderRows.concat(t)}},computed:{saleInfo:function(){return JSON.parse(localStorage.getItem("saleInfo"))},customerData:function(){return JSON.parse(localStorage.getItem("customer"))}},components:{OrderTemplate:y,PRTemplate:_,Order:g["a"],CheckOrder:Q["a"]},destroyed:function(){$(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()}},x=C,D=Object(m["a"])(x,n,a,!1,null,null,null);e["default"]=D.exports}}]);