(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AllPickUpWork"],{"918b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{key:t.keyData},[a("VO",{attrs:{tag:"article"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.handleSubmit;return[a("div",{staticClass:"table-title"},[a("span"),a("button",{staticClass:"btn btn_primary",attrs:{type:"button","data-toggle":"modal","data-target":"#aftersalemodal"}},[t._v(" 新增品項 ")])]),a("div",{staticClass:"table-title"},[a("span",[t._v("取貨品項")])]),t.confirmProduct.length>0?a("section",[a("PickUpTemplate",{attrs:{pickupRows:t.confirmProduct,customer:t.customer,isDisabled:!1},on:{getTotalData:t.getTotalData,getPickupData:t.getPickupData}})],1):a("section",{staticClass:"pl-2 mb-2"},[t._v("暫無取貨品項...")]),a("div",{staticClass:"result-wrap"},[a("div",{staticClass:"item"},[t._v(" 取貨總數量 "),a("span",[t._v(t._s(t.allPickUpQTY))])]),a("div",{staticClass:"amount"},[t._v(" 取貨總金額 "),a("span",[t._v(t._s(t.allPickUpPrice))])]),a("button",{staticClass:"btn btn_info",attrs:{type:"button"},on:{click:function(e){return s(t.checkOrder)}}},[t._v(" 確認取貨 ")])])]}}])}),a("AfterSaleModal",{ref:"AfterSaleModal",attrs:{customer:t.customer,NoWarehouse:!0},on:{sendData:t.sendData,searchData:t.searchData,removeProduct:t.removeProduct}},[a("Table",{key:t.keyData,attrs:{slot:"table",confirmProduct:t.confirmProduct,tempProduct:t.tempProduct},slot:"table"})],1),a("CheckModal",{on:{clickSave:t.confirmPickup}},[a("PickUpTemplate",{attrs:{slot:"orderTemplate",pickupRows:t.confirmProduct,customer:t.customer,isDisabled:!0,pickupData:t.pickupData},on:{getTotalData:t.getTotalData,getPickupData:t.getPickupData},slot:"orderTemplate"})],1)],1)},r=[],i=a("5530"),c=(a("d81d"),a("159b"),a("a9e3"),a("99af"),a("4de4"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",[a("div",{staticClass:"table-wrap"},[a("table",{staticClass:"w-100 common-datatable datatable stripe order-column"},[a("thead",[a("tr",{staticClass:"text-center"},[a("th",[t._v("品號")]),a("th",[t._v("品名/規格")]),a("th",[t._v("寄倉數量")]),a("th",[t._v("可取貨數量")]),a("th",[t._v("取貨數量")]),a("th",[t._v("小計")]),t.isDisabled?t._e():a("th")])]),a("tbody",t._l(t.allProduct,(function(e,s){return a("tr",{key:e.Guid},[a("td",[t._v(t._s(e.ProductId))]),a("td",[t._v(t._s(e.ProductName)+"/"+t._s(e.Specification))]),a("td",{staticClass:"text-center"},[t._v(t._s(e.OrderQuantity))]),a("td",{staticClass:"text-center"},[t._v(t._s(e.PickableQuantity))]),a("VP",{attrs:{tag:"td",name:"需兌換的數量",rules:"max_value:"+e.PickableQuantity+"|min_value:1"}},[a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.cardQuantity,expression:"product.cardQuantity",modifiers:{number:!0}}],staticClass:"w-100",attrs:{type:"number",max:"999",min:"1",placeholder:"請輸入數量",disabled:t.isDisabled},domProps:{value:e.cardQuantity},on:{keyup:function(a){return t.checkQuantity(e)},change:function(a){return t.checkQuantity(e)},input:function(a){a.target.composing||t.$set(e,"cardQuantity",t._n(a.target.value))},blur:function(e){return t.$forceUpdate()}}})]),a("td",{staticClass:"text-center"},[t._v(" "+t._s(e.cardQuantity*e.UnitPrice)+" ")]),t.isDisabled?t._e():a("td",[a("button",{staticClass:"btn btn_danger",attrs:{type:"button"},on:{click:function(e){return t.delItem(s)}}},[t._v(" 移除 ")])])],1)})),0)])]),a("section",{staticClass:"modal-content border-0",staticStyle:{"background-color":"transparent"}},[a("div",{staticClass:"modal-body p-0 mh-100",staticStyle:{"background-color":"transparent",overflow:"unset"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-12 col-md-6"},[a("div",{staticClass:"field"},[a("div",{staticClass:"field-name"},[t._v("客戶名稱")]),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.sendData.CustomerFullName,expression:"sendData.CustomerFullName",modifiers:{trim:!0}}],attrs:{type:"text",disabled:"",placeholder:"客戶名稱"},domProps:{value:t.sendData.CustomerFullName},on:{change:t.sendPickupData,input:function(e){e.target.composing||t.$set(t.sendData,"CustomerFullName",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])])]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-12 col-md-6"},[a("div",{staticClass:"field"},[a("div",{staticClass:"field-name"},[t._v("客戶代號")]),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.sendData.CustomerID,expression:"sendData.CustomerID",modifiers:{trim:!0}}],attrs:{type:"text",disabled:"",placeholder:"客戶代號"},domProps:{value:t.sendData.CustomerID},on:{change:t.sendPickupData,input:function(e){e.target.composing||t.$set(t.sendData,"CustomerID",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])]),a("div",{staticClass:"col-sm-12 col-md-6"},[a("div",{staticClass:"field"},[a("div",{staticClass:"field-name"},[t._v("統一編號")]),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.sendData.TaxID,expression:"sendData.TaxID",modifiers:{trim:!0}}],attrs:{type:"text",disabled:"",placeholder:"統一編號"},domProps:{value:t.sendData.TaxID},on:{change:t.sendPickupData,input:function(e){e.target.composing||t.$set(t.sendData,"TaxID",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])]),a("div",{staticClass:"col-sm-12 col-md-6"},[a("div",{staticClass:"field"},[a("div",{staticClass:"field-name"},[t._v("聯絡人")]),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.sendData.Contact,expression:"sendData.Contact",modifiers:{trim:!0}}],attrs:{type:"text",disabled:"",placeholder:"聯絡人"},domProps:{value:t.sendData.Contact},on:{change:t.sendPickupData,input:function(e){e.target.composing||t.$set(t.sendData,"Contact",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])]),a("div",{staticClass:"col-sm-12 col-md-6"},[a("div",{staticClass:"field"},[a("div",{staticClass:"field-name"},[t._v("聯絡人電話")]),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.sendData.TEL_NO,expression:"sendData.TEL_NO",modifiers:{trim:!0}}],attrs:{type:"text",disabled:"",placeholder:"聯絡人電話"},domProps:{value:t.sendData.TEL_NO},on:{change:t.sendPickupData,input:function(e){e.target.composing||t.$set(t.sendData,"TEL_NO",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])]),a("VP",{staticClass:"col-sm-12 col-md-6",attrs:{tag:"div",rules:"required",name:"取貨人"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.errors;return[a("div",{staticClass:"field",class:s[0]?" mb-0":""},[a("div",{staticClass:"field-name"},[t._v("取貨人名稱")]),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.sendData.ReceiveName,expression:"sendData.ReceiveName",modifiers:{trim:!0}}],attrs:{type:"text",disabled:t.isDisabled,placeholder:"取貨人名稱"},domProps:{value:t.sendData.ReceiveName},on:{change:t.sendPickupData,input:function(e){e.target.composing||t.$set(t.sendData,"ReceiveName",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),s?a("span",{staticClass:"mb-2 font-weight-bold text-danger small"},[t._v(" "+t._s(s[0])+" ")]):t._e()]}}])}),a("VP",{staticClass:"col-sm-12 col-md-6",attrs:{tag:"div",rules:"required",name:"連絡電話"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.errors;return[a("div",{staticClass:"field",class:s[0]?" mb-0":""},[a("div",{staticClass:"field-name"},[t._v("取貨人連絡電話")]),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.sendData.ReceiveContact,expression:"sendData.ReceiveContact",modifiers:{trim:!0}}],attrs:{type:"text",disabled:t.isDisabled,placeholder:"取貨人連絡電話"},domProps:{value:t.sendData.ReceiveContact},on:{change:t.sendPickupData,input:function(e){e.target.composing||t.$set(t.sendData,"ReceiveContact",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),s?a("span",{staticClass:"mb-2 font-weight-bold text-danger small"},[t._v(" "+t._s(s[0])+" ")]):t._e()]}}])}),a("VP",{staticClass:"col-sm-12 col-md-12",attrs:{tag:"div",rules:"required",name:"取貨地址"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.errors;return[a("div",{staticClass:"field",class:s[0]?" mb-0":""},[a("div",{staticClass:"field-name"},[t._v("取貨地址")]),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.sendData.ReceiveAddress,expression:"sendData.ReceiveAddress",modifiers:{trim:!0}}],attrs:{disabled:t.isDisabled,type:"text",placeholder:"取貨地址"},domProps:{value:t.sendData.ReceiveAddress},on:{change:t.sendPickupData,input:function(e){e.target.composing||t.$set(t.sendData,"ReceiveAddress",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),s?a("span",{staticClass:"mb-2 font-weight-bold text-danger small"},[t._v(" "+t._s(s[0])+" ")]):t._e()]}}])}),a("div",{staticClass:"col-sm-12 col-md-12"},[a("div",{staticClass:"field"},[a("div",{staticClass:"field-name"},[t._v("備註")]),a("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.sendData.Memo,expression:"sendData.Memo",modifiers:{trim:!0}}],staticClass:"pl-2",attrs:{readonly:t.isDisabled,placeholder:"備註"},domProps:{value:t.sendData.Memo},on:{change:t.sendPickupData,input:function(e){e.target.composing||t.$set(t.sendData,"Memo",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])])],1)])])])}),o=[],n=(a("a434"),{name:"PickUpTemplate",props:{pickupRows:{type:Array,required:!0},customer:{type:Object,required:!0},isDisabled:{type:Boolean,required:!0},pickupData:{type:Object}},data:function(){return{allProduct:[],currentObj:{},sendData:{CustomerFullName:"",CustomerID:"",Contact:"",TEL_NO:"",TaxID:"",ReceiveName:"",ReceiveContact:"",ReceiveAddress:"",Memo:""}}},methods:{checkQuantity:function(t){var e=this;e.currentObj=Object(i["a"])({},t),e.currentObj.cardQuantity>e.currentObj.PickableQuantity&&(t.cardQuantity=e.currentObj.PickableQuantity,e.$notify({title:"提示",message:"取貨數量不得大於可取貨數量",type:"warning",duration:3500})),e.$emit("getTotalData")},sendPickupData:function(){var t=this;t.$emit("getPickupData",t.sendData)},delItem:function(t){var e=this;e.allProduct.splice(t,1),e.$store.commit("SUREPRODUCT",e.allProduct)}},watch:{pickupData:function(t){var e=this;e.sendData=t}},mounted:function(){var t=this;t.allProduct=t.pickupRows,t.sendData={CustomerFullName:t.customer.CustomerFullName,CustomerID:t.customer.CustomerID,Contact:t.customer.Contact,TEL_NO:t.customer.TEL_NO,TaxID:t.customer.TaxID,ReceiveName:t.customer.Contact,ReceiveContact:t.customer.TEL_NO,ReceiveAddress:t.customer.Address,Memo:""}},destroyed:function(){$(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()}}),d=n,l=a("2877"),u=Object(l["a"])(d,c,o,!1,null,null,null),m=u.exports,p=a("6e77"),v=a("a9de"),f=a("16f6"),C=a("5214"),D=a("ac85"),P=a("329e"),h=a("2f62"),b={name:"AllPickUpWork",mixins:[p["a"],v["a"],f["a"]],data:function(){return{totalExchangeQuantity:0,keyData:1,confirmProduct:JSON.parse(localStorage.getItem("sureProduct")),tempProduct:[],allPickUpPrice:0,allPickUpQTY:0,pickupData:{}}},methods:{checkOrder:function(){$("#commoncheckmodal").modal("show")},confirmPickup:function(){var t=this;if(0===t.confirmProduct.length)return t.$notify({title:"提示",message:"請先選擇商品",type:"warning",duration:3500}),!1;var e="".concat("https://api.yahome-test.com.tw/HiqbioApi","/Inventory/Warehouse/WarehousePickupProducts"),a=t.confirmProduct.map((function(t){return{ItemNo:t.ProductId,ItemName:t.ProductName,Variant:t.Specification,Uom:t.UOM,GiftSpareQty:0,PickupQty:t.cardQuantity}})),s={CustomerId:t.pickupData.CustomerID,DeptId:t.customer.DeptID,CustomerFullName:t.pickupData.CustomerFullName,Contact:t.pickupData.Contact,ContactTel:t.pickupData.TEL_NO,Memo:t.pickupData.Memo,PickupContact:t.pickupData.ReceiveName,PickupContactTel:t.pickupData.ReceiveContact,PickupAddress:t.pickupData.ReceiveAddress,SalesId:t.saleInfo.EmpID,TaxId:t.pickupData.TaxID,IsExchange:!1,CreateUser:localStorage.getItem("uofUserGuid"),WarehousePickups:a,WarehouseExchange:null};t.$store.commit("ISLOADING",!0),t.$http.post(e,s).then((function(e){e.data.ErrorMessage||(t.$notify({title:"成功",message:"取貨作業完成",type:"success",duration:3500}),t.$store.commit("ISLOADING",!1),t.$router.push({name:"OrderFinish",params:{text:"寄倉取貨單"}}))})).catch((function(e){t.$store.commit("ISLOADING",!1),400===e.response.statue&&t.$notify({title:"錯誤",message:e.response.data,type:"error",duration:3500})}))},sendData:function(){var t=this;t.concatProduct("tempProduct","confirmProduct"),t.$store.commit("SUREPRODUCT",t.confirmProduct),$("#aftersalemodal").modal("hide")},getTotalData:function(){var t=this,e=0,a=0;t.confirmProduct.length>0?t.confirmProduct.forEach((function(t){a+=Number(t.UnitPrice*t.cardQuantity),e+=Number(t.cardQuantity)})):e=0,t.allPickUpQTY=e,t.allPickUpPrice=a},getPickupData:function(t){var e=this;e.pickupData=Object(i["a"])({},t)},searchData:function(){var t=this,e=t.$refs.AfterSaleModal.searchBox,a=e.productSeries?e.productSeries.Code:"",s="".concat("https://api.yahome-test.com.tw/HiqbioApi","/Inventory/Warehouse/GetPickableProducts?customerId=").concat(t.customer.CustomerID,"&productSeries=").concat(a,"&productClass=").concat(e.productType,"&keyword=").concat(e.keyword);t.$store.commit("ISLOADING",!0),t.$http.get(s).then((function(e){if(e.data.ErrorMessage)t.$notify({title:"錯誤",message:e.data.ErrorMessage,type:"error",duration:3500});else{var a=[];e.data.Data.some((function(e){var s=!1;t.confirmProduct.some((function(t){if(e.ProductId===t.ProductId&&e.ProductName===t.ProductName)return s=!0,!0})),s||a.push(e)})),a=a.filter((function(t){return t.PickableQuantity>0})),t.tempProduct=a}t.$store.commit("ISLOADING",!1)})).catch((function(){t.$store.commit("ISLOADING",!1)}))},removeProduct:function(){var t=this;t.tempProduct=[]}},watch:{confirmProduct:function(){var t=this;t.keyData+=1,t.getTotalData()}},computed:Object(i["a"])({saleInfo:function(){return JSON.parse(localStorage.getItem("saleInfo"))},customer:function(){return JSON.parse(localStorage.getItem("customer"))}},Object(h["b"])({localSureProduct:"confirmProduct"})),mounted:function(){var t=this;t.$store.commit("HEADER","寄倉取貨作業"),t.$store.commit("ISWELCOME",!1),t.$store.commit("ISGOBACK",!0),0===JSON.parse(localStorage.getItem("sureProduct")).length&&t.$router.back(),t.confirmProduct=t.$route.params.confirmProduct||t.localSureProduct,t.confirmProduct.forEach((function(e){t.allPickUpQTY+=e.cardQuantity}))},components:{PickUpTemplate:m,AfterSaleModal:C["a"],Table:D["a"],CheckModal:P["a"]},destroyed:function(){$(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()}},k=b,_=Object(l["a"])(k,s,r,!1,null,null,null);e["default"]=_.exports},ac85:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("table",{staticClass:"common-datatable datatable stripe order-column w-100"},[t._m(0),a("tbody",{staticClass:"line"},t._l(t.confirmProduct,(function(e){return a("tr",{key:e.ProductId},[a("td",[t._v(t._s(e.ProductId))]),a("td",{staticClass:"tdShort"},[t._v(" "+t._s(e.ProductName)+"/"+t._s(e.Specification)+" ")]),a("td",{staticClass:"text-center"},[t._v(t._s(e.UOM))]),a("td",{staticClass:"text-center"},[t._v(t._s(e.OrderQuantity))]),a("td",{staticClass:"text-center"},[t._v(t._s(e.PickableQuantity))]),a("td",{staticClass:"text-center"},[a("label",{staticClass:"y-checkbox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.IsConfirm,expression:"product.IsConfirm"}],attrs:{disabled:"",type:"checkbox"},domProps:{checked:Array.isArray(e.IsConfirm)?t._i(e.IsConfirm,null)>-1:e.IsConfirm},on:{change:function(a){var s=e.IsConfirm,r=a.target,i=!!r.checked;if(Array.isArray(s)){var c=null,o=t._i(s,c);r.checked?o<0&&t.$set(e,"IsConfirm",s.concat([c])):o>-1&&t.$set(e,"IsConfirm",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(e,"IsConfirm",i)}}}),a("i",{staticClass:"fas fa-check-square text-secondary"})])])])})),0),a("tbody",t._l(t.tempProduct,(function(e){return a("tr",{key:e.ProductId},[a("td",[t._v(t._s(e.ProductId))]),a("td",[t._v(t._s(e.ProductName)+"/"+t._s(e.Specification))]),a("td",{staticClass:"text-center"},[t._v(t._s(e.UOM))]),a("td",{staticClass:"text-center"},[t._v(t._s(e.OrderQuantity))]),a("td",{staticClass:"text-center"},[t._v(t._s(e.PickableQuantity))]),a("td",{staticClass:"text-center"},[a("label",{staticClass:"y-checkbox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.IsConfirm,expression:"product.IsConfirm"}],attrs:{name:"IsConfirm",type:"checkbox"},domProps:{checked:Array.isArray(e.IsConfirm)?t._i(e.IsConfirm,null)>-1:e.IsConfirm},on:{change:function(a){var s=e.IsConfirm,r=a.target,i=!!r.checked;if(Array.isArray(s)){var c=null,o=t._i(s,c);r.checked?o<0&&t.$set(e,"IsConfirm",s.concat([c])):o>-1&&t.$set(e,"IsConfirm",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(e,"IsConfirm",i)}}}),a("i",{staticClass:"fas fa-check-square"})])])])})),0)])},r=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",[a("th",[t._v("品號")]),a("th",[t._v("品名/規格")]),a("th",{staticClass:"text-center"},[t._v("單位")]),a("th",{staticClass:"text-center"},[t._v("寄倉數量")]),a("th",{staticClass:"text-center"},[t._v("可取貨數量")]),a("th",{staticClass:"text-center"},[t._v("選擇產品")])])])}],i={name:"PickUpModalTemplate",props:{tempProduct:{type:Array,required:!0},confirmProduct:{type:Array}}},c=i,o=a("2877"),n=Object(o["a"])(c,s,r,!1,null,null,null);e["a"]=n.exports}}]);